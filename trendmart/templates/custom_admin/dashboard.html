{% extends 'custom_admin/base_admin.html' %}

{% block content %}
<!-- Stats Cards -->
<!-- Stats Cards -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    <div class="bg-white rounded-xl shadow-lg p-6">
        <div class="flex items-center">
            <div class="p-3 rounded-full bg-blue-500 text-white">
                <i class="fas fa-box text-xl"></i>
            </div>
            <div class="ml-4">
                <p class="text-sm font-medium text-gray-600">Total Products</p>
                <p class="text-2xl font-semibold text-gray-900">{{ total_products }}</p>
            </div>
        </div>
    </div>
    
    <div class="bg-white rounded-xl shadow-lg p-6">
        <div class="flex items-center">
            <div class="p-3 rounded-full bg-green-500 text-white">
                <i class="fas fa-tags text-xl"></i>
            </div>
            <div class="ml-4">
                <p class="text-sm font-medium text-gray-600">Categories</p>
                <p class="text-2xl font-semibold text-gray-900">{{ total_categories }}</p>
            </div>
        </div>
    </div>
    
    <div class="bg-white rounded-xl shadow-lg p-6">
        <div class="flex items-center">
            <div class="p-3 rounded-full bg-purple-500 text-white">
                <i class="fas fa-mouse-pointer text-xl"></i>
            </div>
            <div class="ml-4">
                <p class="text-sm font-medium text-gray-600">Total Clicks</p>
                <p class="text-2xl font-semibold text-gray-900">
                    {% if total_clicks >= 1000 %}
                        {{ total_clicks|floatformat:0|slice:":1" }}{{ total_clicks|floatformat:0|slice:"1:"|length|add:"-1"|slice:":1" }}.{{ total_clicks|floatformat:0|slice:"1:4" }}K
                    {% else %}
                        {{ total_clicks }}
                    {% endif %}
                </p>
                <p class="text-xs text-purple-600 mt-1">{{ recent_clicks_week }} this week</p>
            </div>
        </div>
    </div>
    
    <div class="bg-white rounded-xl shadow-lg p-6">
        <div class="flex items-center">
            <div class="p-3 rounded-full bg-yellow-500 text-white">
                <i class="fas fa-star text-xl"></i>
            </div>
            <div class="ml-4">
                <p class="text-sm font-medium text-gray-600">Avg Rating</p>
                <p class="text-2xl font-semibold text-gray-900">{{ avg_rating }}/5</p>
            </div>
        </div>
    </div>
</div>


<!-- Charts Row -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
    <div class="bg-white rounded-xl shadow-lg p-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">Products by Category</h3>
        <canvas id="categoryChart" width="400" height="200"></canvas>
    </div>
    
    <div class="bg-white rounded-xl shadow-lg p-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">Top Clicked Products</h3>
        <canvas id="clicksChart" width="400" height="200"></canvas>
    </div>
</div>

<!-- Recent Activity -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <div class="bg-white rounded-xl shadow-lg p-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">
            <i class="fas fa-fire text-orange-500 mr-2"></i>
            Trending Products
        </h3>
        <div class="space-y-4">
            {% for product in trending_products %}
                <div class="flex items-center space-x-4 p-3 bg-gray-50 rounded-lg">
                    <img src="{{ product.image_url }}" alt="{{ product.title }}" class="w-12 h-12 rounded-lg object-cover">
                    <div class="flex-1">
                        <h4 class="font-semibold text-gray-900 text-sm">{{ product.title|truncatechars:30 }}</h4>
                        <p class="text-gray-600 text-xs">{{ product.click_count }} clicks • ${{ product.price }}</p>
                    </div>
                    <div class="text-orange-500 font-bold">
                        #{{ forloop.counter }}
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
    
    <div class="bg-white rounded-xl shadow-lg p-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">
            <i class="fas fa-plus text-green-500 mr-2"></i>
            Recent Products
        </h3>
        <div class="space-y-4">
            {% for product in recent_products %}
                <div class="flex items-center space-x-4 p-3 bg-gray-50 rounded-lg">
                    <img src="{{ product.image_url }}" alt="{{ product.title }}" class="w-12 h-12 rounded-lg object-cover">
                    <div class="flex-1">
                        <h4 class="font-semibold text-gray-900 text-sm">{{ product.title|truncatechars:30 }}</h4>
                        <p class="text-gray-600 text-xs">{{ product.created_at|date:"M d, Y" }} • {{ product.category.name }}</p>
                    </div>
                    <div class="text-gray-500">
                        <i class="fas fa-clock"></i>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
</div>

<script>
    // Category Chart
    fetch('/admin/analytics-data/')
        .then(response => response.json())
        .then(data => {
            const ctx1 = document.getElementById('categoryChart').getContext('2d');
            new Chart(ctx1, {
                type: 'doughnut',
                data: {
                    labels: data.category_data.map(item => item.name),
                    datasets: [{
                        data: data.category_data.map(item => item.count),
                        backgroundColor: ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
            
            // Clicks Chart
            const ctx2 = document.getElementById('clicksChart').getContext('2d');
            new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: data.click_analytics.map(item => item.title),
                    datasets: [{
                        label: 'Clicks',
                        data: data.click_analytics.map(item => item.clicks),
                        backgroundColor: '#3b82f6',
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        });
</script>
{% endblock %}
